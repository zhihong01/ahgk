<?phpclass xxgkDeep extends MY_Controller {    public function __construct() {        parent::__construct();		$this->load->model('site_branch_model', 'site_branch');    }		protected function branchList($parent_id, $limit = 10, $offset = 0, $length = 60, $sort_by = 0) {        $type_id = (int) $type_id;        $arr_sort = array('sort' => 'DESC');        $select = array('_id', 'name','website');        $item_list = $this->site_branch->find(array('parent_id' => $parent_id, 'status' => true, 'openness_on' => true, 'removed' => False), $limit, $offset, $select, $arr_sort);        foreach ($item_list as $key => $item) {            $item_list[$key]['_id'] = (string) ($item['_id']);            if (mb_strlen($item['name']) > $length) {                $item_list[$key]['name'] = mb_substr($item['name'], 0, $length) . '...';            }			if($parent_id=="53fed0122f81a5843bd57125"){				$item_list[$key]['url'] ="/opennessTowns/?branch_id=" . $item['_id'];			}else{				$item_list[$key]['url'] = $item['website']?$item['website']:"/opennessDepartment/?branch_id=" . $item['_id'];			}                    }        return $item_list;    }    public function index() {        $View = new Blitz('template/openness/search-deep.html');        $data = array();		$struct_list = $View->getStruct();        foreach ($struct_list as $struct) {            $matches = array();            if (preg_match('@^/([a-z]+)-([\w\-]+)/$@', $struct, $matches)) {                $action = $matches[1];                $struct_val = trim($matches[0], '/');				if ($action == 'branch') {                    list($parent_id, $limit, $offset, $length, $sort_by, $date_format) = explode('_', $matches[2]);                    if ($parent_id == 'current') {                        $parent_id = $parent_branch_id;                    }                    $item_list = $this->branchList($parent_id, $limit, $offset, $length, $sort_by, $date_format);                }                $data[$struct_val] = $item_list;            }        }		$data['gov_branch_id'] = $this->gov_branch;			$data['location'] = "<a href='/'>网站首页</a> / <a href='javascript:void(0);'>高级搜索</a>";        $View->display($data);    }}?>